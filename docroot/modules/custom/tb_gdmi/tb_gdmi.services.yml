services:
  tb_gdmi.gdmi_utils:
    class: '\Drupal\tb_gdmi\Services\GdmiUtils'
    arguments: ['@entity_type.manager', '@date.formatter']
  tb_gdmi.gdmi_groups:
    class: '\Drupal\tb_gdmi\Services\GdmiGroups'
    arguments: ['@group.membership_loader', '@entity_type.manager']
  tb_gdmi.gdmi_mailer:
    class: '\Drupal\tb_gdmi\Services\GdmiMailer'
    arguments: ['@plugin.manager.mail', '@messenger', '@tb_gdmi_hubspot.transactional_emails', '@tb_gdmi.gdmi_utils']
  tb_gdmi.gdmi_assessment_calculation:
    class: '\Drupal\tb_gdmi\Services\GdmiAssessmentCalculation'
    arguments: ['@entity_type.manager', '@tb_gdmi.gdmi_utils']
  #events subscribers
  tb_gdmi.checkout_completion_event_subscriber:
    class: 'Drupal\tb_gdmi\EventSubscriber\CheckoutCompletionSubscriber'
    arguments:
      - '@database'
      - '@webform_invitation.invitation_codes'
      - '@messenger'
      - '@tb_gdmi.gdmi_mailer'
      - '@tb_gdmi.gdmi_utils'
    tags:
      - { name: event_subscriber }
  tb_gdmi.cart_redirect_subscriber:
    class: Drupal\tb_gdmi\EventSubscriber\CartRedirectSubscriber
    arguments: ['@commerce_cart.cart_provider', '@request_stack']
    tags:
      - { name: event_subscriber }
  tb_gdmi.route_subscriber:
    class: Drupal\tb_gdmi\Routing\GdmiRouteSubscriber
    tags:
      - { name: event_subscriber }
  #access
  tb_gdmi.cart_access_check:
    class: Drupal\tb_gdmi\Access\CartAccessCheck
    arguments: ['@current_user']
    tags:
      - { name: access_check, applies_to: _cart_access_check }
  tb_gdmi.assessment_access_check:
    class: Drupal\tb_gdmi\Access\GdmiAssessmentAccessCheck
    arguments: ['@current_user', '@current_route_match', '@entity_type.manager', '@tb_gdmi.gdmi_groups', '@messenger']
    tags:
      - { name: access_check, applies_to: _assessment_access_check }
  tb_gdmi.group_members_profile_access_check:
    class: Drupal\tb_gdmi\Access\GroupMembersProfileAccessCheck
    arguments: ['@current_user', '@entity_type.manager', '@group.membership_loader', '@current_route_match']
    tags:
      - { name: access_check, applies_to: _group_members_profile_access_check }
  #twig
  tb_gdmi.twig.date_format:
    class: Drupal\tb_gdmi\TwigExtension\GdmiDateFormatExtension
    tags:
      - { name: twig.extension }
  # commerce
  tb_gdmi.assessments_amount_price:
    class: Drupal\tb_gdmi\OrderProcessor\AssessmentsAmountPrice
    tags:
    - { name: commerce_order.order_processor, priority: -300 }