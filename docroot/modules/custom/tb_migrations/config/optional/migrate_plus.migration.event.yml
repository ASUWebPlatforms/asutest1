id: event
label: Import Events
migration_group: thunderbird
migration_tags:
  - tb event

source:
  plugin: url
  # This configuration is ignored by the 'xml' data parser plugin.
  # It only has effect when using the 'simple_xml' data parser plugin.
  data_fetcher_plugin: file
  # Set to 'xml' to use XMLReader https://www.php.net/manual/en/book.xmlreader.php
  # Set to 'simple_xml' to use SimpleXML https://www.php.net/manual/en/ref.simplexml.php
  data_parser_plugin: xml
  urls:
    - 'https://t-birdconnect.com/feeds/831a8fe2fa87fa89c6c838cc3e103c392eb1/events.xml'
  # XPath expression. It is common that it starts with a slash (/).
  item_selector: /events/event

  fields:
    - name: title
      label: 'Title'
      selector: title
    - name: id
      label: 'ID'
      selector: id
    - name: venue
      label: 'Venue'
      selector: venue
    - name: location
      label: 'Location'
      selector: location
    - name: contactEmail
      label: 'Contact Email'
      selector: contact-email
    - name: contactPhoneNumber
      label: 'Contact phone number'
      selector: contact-phone-number
    - name: public
      label: 'Public'
      selector: public
    - name: created
      label: 'Created at'
      selector: created-at
    - name: startDate
      label: 'Start date'
      selector: start-date
    - name: endDate
      label: 'End date'
      selector: end-date
    - name: description
      label: 'Description'
      selector: html-description
    - name: link
      label: 'sharing url'
      selector: sharing-url
    - name: categories
      label: 'categories'
      selector: categories/category
  ids:
    id:
      type: integer

process:
  title: title
  field_id: id
  body/value: description
  body/format:
    plugin: default_value
    default_value: full_html
  field_event_date/value:
    plugin: format_date
    source: startDate
    from_format: 'Y-m-d\TH:i:s\Z'
    to_format: 'Y-m-d\TH:i:s'
  field_end_date/value:
    plugin: format_date
    source: endDate
    from_format: 'Y-m-d\TH:i:s\Z'
    to_format: 'Y-m-d\TH:i:s'
  field_event_location: location
  field_venue: venue
  field_email: contactEmail
  field_phone_number: contactPhoneNumber
  field_public:
    plugin: static_map
    source: public
    map:
      'false': 0
      'true': 1
  field_link/uri: link
  field_event_categories:
    plugin: entity_generate
    source: categories
    entity_type: taxonomy_term
    bundle_key: vid
    bundle: event_categories
    value_key: name
  type:
    plugin: default_value
    default_value: event
  created:
    plugin: format_date
    source: created
    from_format: 'Y-m-d\TH:i:s\Z'
    to_format: 'U'
  uid:
    plugin: default_value
    default_value: 1
  sticky:
    plugin: default_value
    default_value: 0
  promote:
    plugin: default_value
    default_value: 0
  field_event_source:
    plugin: default_value
    default_value: tbirdconnect
destination:
  plugin: 'entity:node'
migration_dependencies: {  }
dependencies:
  enforced:
    module:
      - tb_migrations